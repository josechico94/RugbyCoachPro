:root {
            --sidebar-w: 360px;
            --player-size: 40px;
            --player-font: 14px;
            --blue: #0d6efd;
            --red: #e63946;
            --ink: #e6edf3;
            --panel: #0f1720;
            --panel-2: #111923;
            --border: #1f2a36;
            --shadow: 0 4px 16px rgba(0,0,0,.25);
            --grid: rgba(255,255,255,.08);
            --yellow: #ffd400;
            --accent: #00c2ff;
            --accent2: #7ef29a;
            --warn: #ffd400;
        }
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; background: #0b1720; color: var(--ink); font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,"Noto Sans",sans-serif; }
        .app { height: 100dvh; display: grid; grid-template-columns: var(--sidebar-w) 1fr; }

        .sidebar { background: var(--panel-2); border-right: 1px solid var(--border); padding: 16px; display: flex; flex-direction: column; gap: 12px; overflow: auto; z-index: 1000; -webkit-overflow-scrolling: touch; }
        .sidebar h1 { font-size: 18px; margin: 0 0 8px 0; }
        .group { border: 1px solid var(--border); background: var(--panel); border-radius: 12px; padding: 12px; display: grid; gap: 10px; }
        .group strong { font-size: 12px; text-transform: uppercase; letter-spacing: .06em; opacity: .9; }
        .row { display: grid; gap: 8px; }

        .btn, select, input[type="text"], input[type="number"], input[type="range"], label.chk {
            appearance: none; border: 1px solid #263443; background: #15202b; color: var(--ink);
            padding: .55rem .7rem; border-radius: 10px; box-shadow: var(--shadow); font-size: 14px;
        }
        .btn { cursor: pointer; text-align: center; }
        .btn:hover { filter: brightness(1.08); }
        .btn.alt { background: #0e2235; }
        .btn.primary { background: var(--accent); color: #000; font-weight: 600; }
        .btn.danger { background: var(--red); color: #fff; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn.active { background: var(--blue); border-color: var(--blue); }

        small.note { opacity:.8 }
        .legend { display:flex; align-items:center; gap:8px; font-size: 13px; }
        .swatch { width: .9em; height: .9em; border-radius: 50%; display:inline-block; }

        .stage { position: relative; display: grid; place-items: center; padding: 16px; overflow: hidden; }
        .board-viewport { position: relative; width:100%; height:100%; contain: layout paint; }
        .board-wrap { position: absolute; width: 1200px; height: 700px; transform-origin: top left; }
        .board { position: absolute; inset: 0; background: #137a46; overflow: hidden; border-radius: 18px; box-shadow: 0 10px 40px rgba(0,0,0,.4); }

        .board::before {
            content:""; position:absolute; inset:0; pointer-events:none;
            background-image: linear-gradient(90deg, rgba(255,255,255,.02) 0 5%, transparent 5% 10%, rgba(255,255,255,.02) 10% 15%, transparent 15% 20%, rgba(255,255,255,.02) 20% 25%, transparent 25% 30%, rgba(255,255,255,.02) 30% 35%, transparent 35% 40%, rgba(255,255,255,.02) 40% 45%, transparent 45% 50%, rgba(255,255,255,.02) 50% 55%, transparent 55% 60%, rgba(255,255,255,.02) 60% 65%, transparent 65% 70%, rgba(255,255,255,.02) 70% 75%, transparent 75% 80%, rgba(255,255,255,.02) 80% 85%, transparent 85% 90%, rgba(255,255,255,.02) 90% 95%, transparent 95% 100%);
        }
        .grid-overlay { position:absolute; inset:0; pointer-events:none; opacity:.6; display:none; }
        .grid-overlay.active { display:block; }

        /* CORRECCIÓN 1: Dejamos pointer-events: none en la capa draw por defecto para que las interacciones del board (selección) funcionen, y lo activamos con JS para dibujar. */
        .lines, #draw { position:absolute; inset:0; pointer-events:none; }
        svg { width:100%; height:100%; display:block; }

        /* Mantenemos touch-action:none para un manejo fluido en dispositivos táctiles */
        body, #boardViewport, #boardWrap, #board, #players, #ball, #draw { touch-action:none; }

        #players { position:absolute; inset:0; z-index:3; pointer-events:none; }
        .player { pointer-events:auto; position:absolute; width:40px; height:40px; border-radius:50%; display:grid; place-items:center; font-weight:700; font-size:14px; color:#fff; cursor:grab; border:2px solid #fff; box-shadow: var(--shadow); transition: background-color 0.2s; }
        
        /* USANDO VARIABLES CSS DINÁMICAS PARA COLORES DE EQUIPO */
        .player[data-team="blue"] { background: var(--blue); } 
        .player[data-team="red"] { background: var(--red); }
        
        .player.selected { border: 3px solid var(--accent); box-shadow: 0 0 10px var(--accent); }
        .player:active, #ball:active { cursor: grabbing !important; }
        
        #ball { position:absolute; z-index:4; }
        .ball { width:50px; height:30px; background: var(--yellow); border: 2px solid #fff; border-radius: 50% / 60%; transform: translate(-50%,-50%) rotate(-15deg); box-shadow: 0 3px 12px rgba(0,0,0,.35); cursor: grab; }
        .ball::after { content:""; position:absolute; inset:6px 18px; border-radius:50% / 60%; border:2px dashed rgba(0,0,0,.25); }
        .label { font-size:12px; font-weight:700; fill:#fff; text-shadow: 0 1px 2px rgba(0,0,0,.6); }

        /* ... Estilos de Menu/Responsive ... */

        .hamburger { 
            position: fixed; 
            top: calc(12px + env(safe-area-inset-top)); 
            left: calc(12px + env(safe-area-inset-left)); 
            width: 44px; 
            height: 44px; 
            display: none; 
            place-items: center; 
            font-size: 22px; 
            border: 1px solid #263443; 
            background: #15202b; 
            color: var(--ink); 
            border-radius: 10px; 
            box-shadow: var(--shadow); 
            z-index: 1100; 
            cursor: pointer;
        }
        .close-drawer { display: none; position: sticky; top: 0; margin-left: auto; width: 36px; height: 36px; border: 1px solid #263443; background: #15202b; color: var(--ink); border-radius: 10px; box-shadow: var(--shadow); z-index: 1001; place-items: center; }
        .scrim { position: fixed; inset: 0; background: rgba(0,0,0,.45); opacity: 0; pointer-events: none; transition: opacity .2s ease; z-index: 900; }
        .scrim.show { opacity: 1; pointer-events: auto; }
        .login-overlay { position: fixed; inset: 0; background: #0b1720; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; padding: 20px; }
        .login-container { background: var(--panel); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border); width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 1rem; }
        .login-header { text-align: center; margin-bottom: 1rem; }
        .login-header h1 { color: var(--accent); margin: 0 0 0.5rem 0; font-size: 1.5rem; }
        .login-header p { color: var(--ink); opacity: 0.8; margin: 0; }
        .login-input { width: 100%; padding: 12px; background: #0c1c2b; color: var(--ink); border: 1px solid var(--border); border-radius: 8px; font-size: 14px; }
        .login-input:focus { outline: none; border-color: var(--accent); }
        .auth-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .login-btn { width: 100%; padding: 12px; background: var(--accent); color: #000; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; }
        .login-btn.secondary { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
        .login-btn.secondary:hover { background: rgba(0, 194, 255, 0.1); }
        .google-btn { width: 100%; padding: 12px; background: #fff; color: #333; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
        .google-btn:hover { filter: brightness(0.95); }
        .login-btn:disabled, .google-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .separator { display: flex; align-items: center; text-align: center; color: var(--ink); opacity: 0.5; font-size: 12px; }
        .separator::before, .separator::after { content: ''; flex: 1; border-bottom: 1px solid var(--border); }
        .separator:not(:empty)::before { margin-right: .5em; }
        .separator:not(:empty)::after { margin-left: .5em; }
        .login-message { text-align: center; font-size: 0.85rem; margin: 0; min-height: 20px; }
        .login-error { color: var(--red); }
        .login-success { color: var(--accent2); }
        
        /* CORRECCIÓN: Estilo de Alerta de Firebase */
        .status-indicator { display: flex; align-items: center; gap: 8px; font-size: 12px; padding: 8px 12px; border-radius: 8px; background: var(--panel); border: 1px solid var(--border); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); }
        .status-dot.offline { background: var(--warn); }
        .status-dot.error { background: var(--red); }

        .firebase-status { 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 12px; 
            margin-top: 8px; 
            display: none; 
            text-align: center;
        }
        .firebase-status.connected { 
            background: rgba(126, 242, 154, 0.1); 
            border: 1px solid var(--accent2); 
            color: var(--accent2); 
            display: none; /* Ocultamos la alerta de éxito si todo está bien */
        }
        .firebase-status.disconnected { 
            background: rgba(230, 57, 70, 0.1); 
            border: 1px solid var(--red); 
            color: var(--red); 
            display: block; /* Mantenemos el bloque visible si hay error */
        }
        
        .player-counter { display: flex; align-items: center; gap: 8px; font-size: 13px; opacity: 0.8; }
        .success-popup { position: fixed; top: 20px; right: 20px; background: var(--accent2); color: #000; padding: 16px 20px; border-radius: 10px; box-shadow: var(--shadow); z-index: 2000; display: flex; align-items: center; gap: 10px; font-weight: 600; transition: transform 0.3s ease; }
        .success-popup.show { transform: translateX(0); }
        .success-popup.hide { transform: translateX(400px); }
        .btn.selection-tool { background: var(--blue); border-color: var(--blue); }

        /* --- MODAL PREMIUM --- */
        .premium-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 4000; padding: 20px; animation: fadeIn 0.3s ease; }
        .premium-card { background: linear-gradient(145deg, #1a2634, #111923); border: 1px solid #ffd400; box-shadow: 0 0 30px rgba(255, 212, 0, 0.15); padding: 2.5rem; border-radius: 16px; width: 100%; max-width: 450px; text-align: center; position: relative; }
        .premium-icon { font-size: 3rem; margin-bottom: 1rem; display: inline-block; filter: drop-shadow(0 0 10px rgba(255, 212, 0, 0.5)); }
        .premium-title { font-size: 1.8rem; color: #fff; margin: 0 0 10px 0; background: -webkit-linear-gradient(#ffd400, #ffa500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        .premium-desc { color: #a0aec0; margin-bottom: 20px; line-height: 1.5; }
        .premium-features { text-align: left; margin: 20px 0; background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; }
        .premium-features li { list-style: none; margin-bottom: 8px; color: #e6edf3; display: flex; align-items: center; gap: 10px; }
        .premium-btn { background: #ffd400; color: #000; font-weight: 800; font-size: 1.1rem; padding: 14px 30px; border: none; border-radius: 30px; cursor: pointer; width: 100%; transition: transform 0.2s, box-shadow 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .premium-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(255, 212, 0, 0.4); }
        .close-premium { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; opacity: 0.5; }
        .close-premium:hover { opacity: 1; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media (max-width: 900px) {
            :root { --sidebar-w: min(86vw, 420px); }
            html, body { overflow: hidden; height: 100dvh; }
            .app { grid-template-columns: 1fr; height: 100dvh; }
            .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: var(--sidebar-w); transform: translateX(-105%); transition: transform .25s ease; padding-top: calc(12px + env(safe-area-inset-top)); z-index: 1000; }
            .sidebar.open { transform: translateX(0); }
            .close-drawer { display: grid; }
            .hamburger { display: grid; }
            .stage { padding: 0; }
            .board-viewport { position: fixed; top: 0; left: 0; right: 0; bottom: 0; overflow: hidden; background: #0b1720; }
        }

        @media (max-width: 900px) {
            .hamburger { display: grid !important; }
            .main-app-visible .hamburger { display: grid !important; }
        }
